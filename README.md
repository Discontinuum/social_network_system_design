# Дизайн социальной сети для курса System Design

## Функциональные требования

* Добавление постов (с текстом + фотографиями + привязкой к месту)
* Добавление оценок к постам
* Добавление комментариев к постам
* Подписка на аккаунты других пользователей
* Поиск мест по популярности
* Поиск постов по месту
* Просмотр ленты пользователя, составленной из постов тех, на кого он подписан

## Нефункциональные требования

* DAU = 10 000 000
* Аудитория стран СНГ
* Данные храним всегда
* Сезонность: новогодние праздники + майские праздники + летний сезон отпусков (июль-август)
* Лимиты:
    * Пользователь может иметь не более 500 подписок
    * Пользователь может отправлять посты не чаще 1 раза в пять минут (т.е. не более 288 (примерно 300) постов в день)
    * Пост может содержать не более 5 изображений весом не более 1Мб каждое и до 1 Кб текста. Привязка поста - только к одному месту
    * Комментарий может содержать не более 280 символов (560 байтов, если представим русский текст в UTF-8, в среднем 0,5 Кбайта)
    * Пользователь может оставлять не более 2 комментариев в минуту (2880 в день)
    * Пользователь может оставлять не более 60 оценок в минуту (86400 в сутки)
* Активность (предположительная):
    * Пользователь в среднем смотрит ленту 24 раза за сутки (из соображения 2 раза в час в течение 12 дневных часов)
    * За один просмотр ленты пользователь смотрит 10 постов и реагирует в среднем на половину из них. Всего за сутки 240 постов и 120 реакций
    * Постящие пользователи постят в среднем 3 раза в день
    * Комментирующие пользователи в среднем оставляют 20 комментариев в день
    
## Подсчёт нагрузки
Для подсчёта нагрузки будем опираться на правило 1-9-90 в редакции: 1% пользователей активно постят, 9% пользователей комментируют, 90% просто смотрят/реагируют.

### Нагрузка по ленте постов
RPS (read) по запросам конкретно ленты (по 10 последних постов в ней в среднем)

    RPS (read) = DAU * avg feed access per day / 86400
    RPS (read) = 10 000 000 * 24 / 86400 = 2777 (approx 3000)

Считаем, что ленту смотрят все
    
    RPS (write i.e. creating a post) = DAU * posters ratio * avg posts per day / 86400
    RPS (write) = 10 000 000 * 0.01 * 3 / 86400 = 30 000 0 / 86400 = approx 3,5
    
Оценим размер поста по максимальному: 5Мб засчет 5 изображений. Текст и привязка займут несколько килобайт, ими пренебрежем

    Traffic (read) = RPS (read) * avg posts in feed * post size = 3000 reqs/sec * 10 * 5 Mb = 150 Gb/sec
    Traffic (write) = RPS (write) * post size = 3,5 reqs/sec * 5Mb = 17,5 Mb/sec

### Нагрузка по комментариям
Для упрощения считаем, что комментарии читают и пишут только 9%

    RPS = DAU * commenters ratio * avg comments / 86400
    RPS = 10 000 000 * 0.09 * 20 / 86400 = 18 000 000 / 86400 = 208
    
Комментарий оценивался в 0,5 Кбайта объёма

    Traffic = RPS * avg size = 208 reqs/sec * 0.5 Kb = 104 Kb/sec

### Нагрузка по реакциям
    RPS (write) = DAU * avg reacts / 86400 = 10 000 000 * 120 / 86400 = approx. 15000

Информация о реакции: код реакции, id поста. Если представить их двумя GUID'ами (что может быть и избыточно), получим 24 B на реакцию

    Traffic (write) = RPS(write) * react size = 15000 * 24B = approx 360 Kb/sec
